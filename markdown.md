![Logo](Window.jpg)

# Работа с Git

## 1. Введение. Система контроля версий

Система контроля версий нужна для отслеживания изменений в любых файлах и папках, (например, в программном коде), управления изменениями (например, откат к прежней версии, создания так называемых «веток» в череде фиксируемых «коммитов» и т. д.).
Git — одна из самых популярных систем контроля версий. Особенность Git состоит в том, что система не хранит файлы целиком, а хранит отличия между файлами (снимки).
Например, при сохранении версий текста, Git сохранит первоначальную версию, а при фиксации следующих изменений, сохранит только тот текст, который добавился, а в случае удаления строк запомнит, какие строки были удалены.
Эти снимки пользователь индексирует и фиксирует (коммитит) по собственному разумению, чтобы потом, например, к ним вернуться, сделать ветку из коммитов (снимков состояния).

## 2. Установка и настройка Git и окружения

Загрузить последнюю версию программы с [сайта](https://git-scm.com/downloads).
Установить с настройками по умолчанию.

Установить редактор, с которым будет работать Git, например **Visual Studio Code**.
Можно загрузить по [ссылке](https://code.visualstudio.com/Download).

Чтобы не сохранять вручную каждый раз изменения в редактируемом файле (нажимая Ctrl + S) можно в **VS Code** настроить авто сохранение через меню File (Auto Save). Иначе в статусе файла напротив имени будет иконка в виде маркера (кружочка).

Для проверки, что Git установлен, в терминале нужно выполнить команду
```bash
git --version
```
Если Git установлен, то появится сообщение с информацией о версии программы. Иначе будет сообщение об ошибке.

При первом использовании Git нужно представиться (ввести своё имя и email). Это делается следующими двумя командами:
```bash
git config --global user.name "Ваше имя латиницей"
git config --global user.email Ваш электронный почтовый адрес
```
## 3. Работа в терминале
Предпочтительна работа с терминалом (в командной строке), так как в этом случае предлагается больше возможностей.
Запустить терминал (Ctrl + ~, либо через меню View), выбрать желаемый терминал (через меню терминала Select Default Profile), предпочтительно *bash*.
Закрыть терминал можно Ctrl + ~ (либо крестиком), при этом содержимое терминала сохранится.
Иконка с корзиной останавливает терминал (завершает работу).

Длинное имя файла можно полностью не набирать на клавиатуре, достаточно набрать начальные символы и нажать клавишу Tab.
Для того, чтобы повторить команду, которую уже выполняли, можно пользоваться стрелками вверх и вниз на клавиатуре. При выборе команды, команды пролистываются в хронологическом порядке.

Если текст вывода команды не помещается на экран, его нужно пролистывать стрелкой вниз, либо PgDn до появления надписи END. Вернуться в командную строку можно, нажав клавишу Q.

Чтобы посмотреть справку по конкретной команде, можно ввести `-h` после команды:
```bash
git <command_name> -h
```
Если в коммандной строке нужно добавить кавычки в заковыченное сообщение для коммита, необходим экранирующий обратный слэш.
Например:
```bash
git commit -m "Added command \"git remote\""
```

## 4. Инициализация репозитория. Начало работы
Создать пустую папку проекта, например, с именем "git".
Открыть **Visual Studio Code** и в разделе Проводник (Explorer) выбрать созданную папку (нажать на кнопку Open Folder). Открыть папку можно через меню File, либо сочетанием клавиш Ctrl + K Ctrl + O.

Проверка, является ли данная папка репозиторием: команда
```bash
git status
```
вернёт информацию, является ли папка (путь виден в приглашении командной строки), в которой мы находимся, репозиторием.
А если посмотреть в папку через проводник операционной системы, включив показ скрытых файлов и папок, можно увидеть скрытую папку .git (в том случае, если это репозиторий).


Чтобы инициализировать репозиторий в папке вашего проекта, нужно ввести команду
```bash
git init
```
После чего создастся скрытая папка .git с определённой структурой папок и файлов в ней, нужной для работы Git.
Команда вернёт информацию об этом действии.
Повторно при работе эту команду использовать не нужно.
Удалить репозиторий можно удалением скрытой папки .git.

Команда
```bash
git status
```
теперь должна вернуть имя ветки, в которой мы находимся (по умолчанию master), статус коммитов, и подсказки следующих команд.

Создать файл можно в разделе Explorer через контекстное меню, либо по нажатию на иконку, появляющуюся после наведения указателя мыши (New File).
Создаём файл формата Markdown с именем, например, GitInstruction.md (с обязательным указанием его расширения). Вверху откроется окно содержимого этого файла.
Откроем окно предпросмотра по иконке справа. Иконка появится, если файл нужного типа, обычные текстовые файлы (*.txt) не имеют режима превью.
Теперь открыто 2 окна (содержимое и превью).
В окне проводника напротив имени созданного нами файла появится буква U, означающая, что файл пока не отслеживаемый (Untracked).
Команда
```bash
git status
```
теперь покажет список не отслеживаемых файлов.

## 5. Запись изменений в репозиторий
Чтобы файлы отслеживались, надо выполнить команду с указанием имен файлов:
```bash
git add GitInstruction.md
```
либо, чтобы включить все файлы и изменения в папке разом:
```bash
git add .
или
git add --all
```
Длинное имя файла можно полностью не набирать на клавиатуре, достаточно набрать начальные символы и нажать клавишу Tab.
Этот способ, кроме ускорения ввода, помогает исключить ошибки в написании имён файлов.
В окне проводника напротив имени созданного нами файла появится буква A, означающая, что файл индексируется (Index Added).

Чтобы закоммитить (зафиксировать) изменения, нужна команда
```bash
git commit -m "Ваше сообщение, описывающее фиксируемый этап"
```

Если теперь внести текст в файл, то статус файла в окне проводника (и в заголовке окна файла) будет M (Modified). Список изменённых файлов покажет также команда `status`.

Команда
```bash
git commit -am "Ваше сообщение, описывающее фиксируемый этап"
```
позволяет обойтись без команды `git add`. Но всегда её следует использовать, так как `git commit -a` подготавливает все изменения в отслеживаемые фалы, что есть в репозитории, но это не всегда нужно. К примеру, если вы не хотите, чтобы не связанные изменения в разных файлах попадали в один коммит, не следует пользоваться этой составной командой.

## 6. Просмотр истории коммитов
Вывод истории всех коммитов (версий) с указанием их хеш-кодов даёт команда
```bash
git log
```
Вывод по умолчанию в обратном хонологическом порядке (первые коммиты самые свежие).
Если текст вывода команды не помещается на экран, его нужно пролистывать стрелкой вниз, либо PgDn до появления надписи END. Вернуться в командную строку можно, нажав клавишу Q.
Полезный параметр у этой команды, который сокращает объём информации:
```bash
git log --oneline
```

## 7. Перемещение между коммитами (сохранениями)
Переход к другому коммиту можно осуществить командой
```bash
git checkout хеш-код
```
Хеш-код можно узнать из вывода команды
```bash
git log --oneline
```
Переход возможен, если проиндексировать и закоммитить последние незакоммиченные изменения.
Возврат к текущему состоянию можно одной из команд (равнозначных):
```bash
git checkout master
либо
git switch -
```
При переходе к ранним коммитам, после внесённых изменений, надо не забывать возвращаться к текущему состоянию, чтобы не потерять коммиты. Другой способ не потерять коммиты — создать новую ветку командой
```bash
git switch -c <имя_ветки>
```

## 8. Игнорирование файлов
Для того, чтобы исключить из отслеживания в репозитории определённые файлы или папки, необходимо создать файл *.gitignore* и записать в него названия или шаблоны ислючаемых файлов или папок. Например:
```bash
*.png (игнорирование файлов изображений с расширением PNG)
/images (игнорирование папки images)
```
В основном этот файл нужен для того, чтобы лишние файлы (изображения, служебные файлы) не попадали в удалённый репозиторий, а также чтобы эти файлы не попадали в список не отслеживаемых, который возвращает, например, команда `git status`.

Сам себя файл .gitignore не должен игнорировать (не нужно писать туда его имя), его надо скопировать в удалённый репозиторий.

Файл .gitignore можно добавить в отслеживаемые.

## 9. Создание веток
Ветки – это черновики.
Они нужны, например, чтобы рапределить работу между сотрудниками.
По умолчанию имя основной ветки в Git — *master*.
Команда
```bash
git branch
```
возвращает список существующих веток. 
Создать ветку можно командой:
```bash
git branch <branchname>
```
Далее, если нужно перейти в новую ветку, на до выполнить команду
```bash
git checkout <branchname>
или
git switch <branchname>
```
Следующие варианты создания веток создают ветку и сразу на неё переключают
```bash
git checkout -b <branchname>
или
git switch -c <branchname>
```
После создания новых веток команда
```bash
git branch
```
показывает звёздочкой (*) ту ветку, в которой вы находитесь. Текущую ветку показывает также **Bash**.

## 10. Слияние веток
Команда `git merge` выполняет слияние двух веток в одну. При этом надо указать название ветки, из которой надо загрузить информацию, а находиться при этом на той ветке, в которую хотим загрузить информацию.
То есть, после внесение изменений в ветке, например, ignorefiles, нужно вернуться в ветку master и сделать слияние с веткой ignorefiles:
```bash
git switch -
git merge ignorefiles
```
Если слияние происходит в другой ветке с общим коммитом для двух веток, то вступает в действие стратегия Fast-forward, разветвление не происходит.
Можно посмотреть графическое представление:
```bash
git log --graph
```
Можно увидеть, что произошло объединение в общий коммит (HEAD -> master, ignorefiles).

## 11. Разрешение конфликтов
При слиянии возможен конфликт текста. После разрешения конфликта (выбора какой текст оставить), нужно обязательно зафиксировать конфликт слияния, например, комбинированной командой
```bash
git commit -am "Комментарий"
```
В статусе файла напротив имени будет восклицательный знак (!).
После того, как мы выбрали, какие изменения принять, либо Входящие, либо Текущие, либо Оба изменения, нужно зафиксировать эти изменения командой
```bash
git commit -am "Сообщение"
```

## 12. Удаление веток

Команда
```bash
git branch -d <branchname>
или
git branch –delete <branchname>
```
удаляет указанную ветку.

Команда
```bash
git branch -D <branchname>
```
принудительно удаляет ветку.

# Работа с удалёнными репозиториями

## 1. Подготовка к работе

  1. Создать локальный репозиторий, например, в папке с именем *remote*.
  2. Создать файл *readme.md*.
  3. Создать аккаунт на [github.com](https://github.com/).
  4. Создать репозиторий в личном кабинете [github.com](https://github.com/), например, с именем Remote. Снять галочку "Создать readme", так как он уже создан локально.

## 2. Команды для первоначальной синхронизации
Выполнить команды для случая "push an existing repository...". Их можно скопировать из личного кабинета.
```bash
git remote add origin <адрес_из_аккаунта>
```
Отображение удалённых репозиториев, команда
```bash
git remote
```
Вернёт список коротких имён.
Параметр -v покажет название и адрес для получения и отправки.

Переименование текущей ветки:
```bash
git branch -M main
```
Отправка данных в удалённый репозиторий:
```bash
git push -u origin main
```

Обновить страницу в браузере.
На Github по умолчанию открывается файл readme.md.

Чтобы редактировать файл, надо нажать на иконку с карандашом.
Есть вкладка Preview.

## 3. Получение изменений в локальный репозиторий

После добавления изменений в файл *readme.md* в удалённом репозитории и зафиксировать их, нажав на кнопку Commit..., добавить коммит (Например, Added command "git pull").

Чтобы получить изменения с удалённого репозитория, надо выполнить команду
```bash
git pull
```

## 4. Отправка изменений в удалённый репозиторий
Можно теперь добавить изменения в локальный репозиторий в файл *readme.md* и зафиксировать их.

Если вызвать команду `git log --graph` будет видно, что коммит "Added command git pull" был получен из удалённого репозитория origin/main, будет показан также ваш ник в GitHub.
Теперь можно отправить изменения в удалённый репозиторий командой
```bash
git push
```

## 5. Конфликты слияния

Так как команда `git pull` делает помимо загрузки изменений также автоматическое слияние веток `git merge`, то после передачи могут возникнуть конфликты.
### Пример
  1. Добавить изменения в удалённый репозиторий, в файл *readme.md*. Зафикировать изменения (закоммитить) Added command "git remote". Скопировать добавленные строки в буфер обмена.
  2. Добавить изменения в локальный репозиторий, в файл *readme.md* — вставить скопированные строки и добавить немного отличий (нарочно сделать ошибки, чтобы потом принять входящие изменения при конфликте).
Зафикировать изменения (закоммитить) "Added command \"git remote\"". Здесь в коммандной если нужно добавить кавычки в заковыченное сообщение для коммита, необходим экранирующий обратный слэш (\).

  3. Если теперь выполнить команду `git pull` (принять изменения с удалённого репозитория, при этом автоматически происходит слияние), получаем конфликт. Принять входящие изменения и сделать коммит слияния.

## 6. Пример работы с чужими репозиториями

  1. Перейти в GitHub и поисковом окне вводим, например, bot.
  2. Выбрать язык программирования, например, C#.
  3. Выбрать, например, Telegram.Bot. Видим содержимое файла README в формате Markdown, количество коммитов, и др.
  4. Можно клонировать репозиторий на свой компьютер. Для этого нажать на кнопку Code, вкладка HTTPS, копировать ссылку.
  5. Перейти в **VS Code** на компьютере и выбрать папку (без репозитория), куда нужно клонировать. Выполнить в терминале команду
  ```bash
  git clone https://github.com/TelegramBots/Telegram.Bot.git
  ```
  Программа должна скачаться в подпапку по умолчанию (Telegram.Bot). При желании можно указать другую подпапку, указав её в конце предыдущей команды.

  6. Нужно перейти в эту папку, например, используя команду `cd`, либо в окне проводника контестное меню на папке "Open in Integrated Terminal". Если посмотреть истрию `git log --graph` можно увидеть, что есть разные авторы. Можно не просматривать все коммиты и нажать на клавишу Q.

## 7. Инструкция по созданию pull request

Pull request — запрос на включение изменений.

### 1. Fork репозитория
Сделать fork нужного репозитория, в который хотели бы внести свой вклад. Из своего аккаунта, находясь на странице нужного (найденного, чужого) репозитория, нажать на кнопку Fork. После этого в ваш собственный GitHub-аккаунт загрузится полная копия этого репозитория и будет свободный доступ к этому репозиторию.

### 2. Клонирование репозитория
Клонировать репозиторий на локальный компьютер. Для этого нажать на кнопку Code, вкладка HTTPS, копировать ссылку. В командной строке программы **VS Code** выполнить команду
```bash
git clone <адрес_скопированной_ссылки> <желаемая_папка>
```
Файлы скопируются и нужно будет перейти в эту папку. Например, использовать команду `cd`, либо в окне проводника контестное меню на папке "Open in Integrated Terminal".

### 3. Создание ветки
Создать ветку для внесения изменений:
```bash
git switch -c <branch_name>
```
Сделать изменения и зафиксировать их коммитами.

### 4. Отправка своей версии
Отправить свою версию изменений на собственный GitHub-аккаунт. После начального коммита можно отправить изменения в удалённый репозиторий
```bash
git push --set-upstream origin <branch_name>
```
После следующих локальных изменений и коммитов для отправки изменений на удалённый репозиторий в новой ветке, можно вводить команду:
```bash
git push
```

### 5. Pull request
Нажать на появившуюся кнопку Pull request.